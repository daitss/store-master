%h1
  requests

%h2 filter request scope

%form{:action => "/requests", :method => "get"}
  %table
    %tr
      %th batch
      %th account
      %th project
      %th user
      %th request type
      %th request status
      %th set scope
    %tr
      %td
        %select{:name => 'batch-scope'}
          %option all
          - Batch.all.each do |b|
            - if @params["batch-scope"] == b.id
              %option{:selected => true}= b.id
            - else
              %option= b.id
      %td
        %select{:name => 'account-scope'}
          %option all
          - Account.all.each do |a|
            - if @params["account-scope"] == a.id
              %option{:selected => true}= a.id
            - else
              %option= a.id
      %td
        %select{:name => 'project-scope'}
          %option all
          - Project.all.each do |p|
            - if @params["project-scope"] == p.id + "-" + p.account.id
              %option{:selected => true} #{p.id}-#{p.account.id}
            - else
              %option #{p.id}-#{p.account.id}
      %td
        %select{:name => 'user-scope'}
          %option all
          - User.all.each do |u|
            - if @params["user-scope"] == u.id
              %option{:selected => true} #{u.id}
            - else
              %option #{u.id}
      %td
        %select{:name => 'type-scope'}
          %option all
          %option disseminate 
          %option withdraw 
          %option peek
          - if @params["type-scope"]
            %option{:selected => true}= @params['type-scope'] 
      %td
        %select{:name => 'status-scope'}
          %option all
          %option enqueued
          %option released 
          %option cancelled
          - if @params["status-scope"]
            %option{:selected => true}= @params['status-scope'] 
      %td
        %input{:type => 'submit', :value => 'Set Scope'}
  
#list
  %h2 request list
  
  - if @requests.any?
    %table
      %tr
        %th IEID
        %th name
        %th project
        %th request type
        %th status
        %th requesting user
        %th request timestamp
        %th package activity
    
      - @requests.each do |r|
        %tr
          %td 
            %a{:href => "/package/#{r.package.id}"}= r.package.id
          %td= r.package.sip.name
          %td= r.package.project.id
          %td= r.type
          %td= r.status
          %td= r.agent.id
          %td= r.timestamp
          %td= r.package.events.first(:order => [:timestamp.desc]).name
