<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta name="Content-Type" content="text/html; charset=utf-8" />
<title>Class: DataModel::Package</title>
<link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '..';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/app.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (P)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../DataModel.html" title="DataModel (module)">DataModel</a></span></span>
     &raquo; 
    <span class="title">Package</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: DataModel::Package
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">DataModel::Package</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
      <dt class="r2">Includes:</dt>
      <dd class="r2">DataMapper::Resource</dd>
      
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">/Users/fischer/WorkProjects/daitss2/store-master/lib/store-master/data-model/packages.rb</dd>
  
</dl>
<div class="clear"></div>



  
  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#etag-instance_method" title="#etag (instance method)">- (Object) <strong>etag</strong> </a>
    

    
  </span>
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
scratch pad attributes filled in on succesful store.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#md5-instance_method" title="#md5 (instance method)">- (Object) <strong>md5</strong> </a>
    

    
  </span>
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
scratch pad attributes filled in on succesful store.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#sha1-instance_method" title="#sha1 (instance method)">- (Object) <strong>sha1</strong> </a>
    

    
  </span>
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
scratch pad attributes filled in on succesful store.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#size-instance_method" title="#size (instance method)">- (Object) <strong>size</strong> </a>
    

    
  </span>
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
scratch pad attributes filled in on succesful store.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#type-instance_method" title="#type (instance method)">- (Object) <strong>type</strong> </a>
    

    
  </span>
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
scratch pad attributes filled in on succesful store.
</p>
</div></span>
  
</li>

    
  </ul>


  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#exists%3F-class_method" title="exists? (class method)">+ (Boolean) <strong>exists?</strong>(name) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#lookup-class_method" title="lookup (class method)">+ (Object) <strong>lookup</strong>(name) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#names-class_method" title="names (class method)">+ (Object) <strong>names</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
TODO: This next is likely to result in such a long list as to be unusable
in practice; need to rethink chunking this up, perhaps with yield.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#store-class_method" title="store (class method)">+ (Object) <strong>store</strong>(data_io, metadata) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#was_deleted%3F-class_method" title="was_deleted? (class method)">+ (Boolean) <strong>was_deleted?</strong>(name) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#delete-instance_method" title="#delete (instance method)">- (Object) <strong>delete</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
on failure may leave orphan.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#delete_copy-instance_method" title="#delete_copy (instance method)">- (Object) <strong>delete_copy</strong>(silo_resource) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#locations-instance_method" title="#locations (instance method)">- (Object) <strong>locations</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
return URI objects for all of the copies we have, in pool-preference order.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#store_copy-instance_method" title="#store_copy (instance method)">- (Object) <strong>store_copy</strong>(io, posting_url, metadata) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  


  
  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id="etag=-instance_method"></span>
      <span id="etag-instance_method"></span>
      <div class="method_details first">
  <p class="signature first" id="etag-instance_method">
  
    - (<tt>Object</tt>) <strong>etag</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
scratch pad attributes filled in on succesful store
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


18
19
20</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/store-master/lib/store-master/data-model/packages.rb', line 18</span>

<span class='def def kw'>def</span> <span class='etag identifier id'>etag</span>
  <span class='@etag ivar id'>@etag</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="md5=-instance_method"></span>
      <span id="md5-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="md5-instance_method">
  
    - (<tt>Object</tt>) <strong>md5</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
scratch pad attributes filled in on succesful store
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


18
19
20</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/store-master/lib/store-master/data-model/packages.rb', line 18</span>

<span class='def def kw'>def</span> <span class='md5 identifier id'>md5</span>
  <span class='@md5 ivar id'>@md5</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="sha1=-instance_method"></span>
      <span id="sha1-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="sha1-instance_method">
  
    - (<tt>Object</tt>) <strong>sha1</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
scratch pad attributes filled in on succesful store
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


18
19
20</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/store-master/lib/store-master/data-model/packages.rb', line 18</span>

<span class='def def kw'>def</span> <span class='sha1 identifier id'>sha1</span>
  <span class='@sha1 ivar id'>@sha1</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="size=-instance_method"></span>
      <span id="size-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="size-instance_method">
  
    - (<tt>Object</tt>) <strong>size</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
scratch pad attributes filled in on succesful store
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


18
19
20</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/store-master/lib/store-master/data-model/packages.rb', line 18</span>

<span class='def def kw'>def</span> <span class='size identifier id'>size</span>
  <span class='@size ivar id'>@size</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="type=-instance_method"></span>
      <span id="type-instance_method"></span>
      <div class="method_details ">
  <p class="signature " id="type-instance_method">
  
    - (<tt>Object</tt>) <strong>type</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
scratch pad attributes filled in on succesful store
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


18
19
20</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/store-master/lib/store-master/data-model/packages.rb', line 18</span>

<span class='def def kw'>def</span> <span class='type identifier id'>type</span>
  <span class='@type ivar id'>@type</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="exists?-class_method">
  
    + (<tt>Boolean</tt>) <strong>exists?</strong>(name) 
  

  
</p><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


26
27
28</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/store-master/lib/store-master/data-model/packages.rb', line 26</span>

<span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='exists? fid id'>exists?</span> <span class='name identifier id'>name</span>
  <span class='not not kw'>not</span> <span class='first identifier id'>first</span><span class='lparen token'>(</span><span class='symbol val'>:name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='symbol val'>:extant</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="lookup-class_method">
  
    + (<tt>Object</tt>) <strong>lookup</strong>(name) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


34
35
36</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/store-master/lib/store-master/data-model/packages.rb', line 34</span>

<span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='lookup identifier id'>lookup</span> <span class='name identifier id'>name</span>
  <span class='first identifier id'>first</span><span class='lparen token'>(</span><span class='symbol val'>:name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='symbol val'>:extant</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="names-class_method">
  
    + (<tt>Object</tt>) <strong>names</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
TODO: This next is likely to result in such a long list as to be unusable
in practice; need to rethink chunking this up, perhaps with yield
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


41
42
43</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/store-master/lib/store-master/data-model/packages.rb', line 41</span>

<span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='names identifier id'>names</span>
  <span class='all identifier id'>all</span><span class='lparen token'>(</span><span class='symbol val'>:extant</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span><span class='comma token'>,</span> <span class='symbol val'>:order</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span> <span class='symbol val'>:name</span><span class='dot token'>.</span><span class='asc identifier id'>asc</span> <span class='rbrack token'>]</span> <span class='rparen token'>)</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='rec identifier id'>rec</span><span class='bitor op'>|</span> <span class='rec identifier id'>rec</span><span class='dot token'>.</span><span class='name identifier id'>name</span> <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="store-class_method">
  
    + (<tt>Object</tt>) <strong>store</strong>(data_io, metadata) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/store-master/lib/store-master/data-model/packages.rb', line 45</span>

<span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='store identifier id'>store</span> <span class='data_io identifier id'>data_io</span><span class='comma token'>,</span> <span class='metadata identifier id'>metadata</span>

  <span class='required_metadata identifier id'>required_metadata</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span> <span class='symbol val'>:name</span><span class='comma token'>,</span> <span class='symbol val'>:ieid</span><span class='comma token'>,</span> <span class='symbol val'>:md5</span><span class='comma token'>,</span> <span class='symbol val'>:size</span><span class='comma token'>,</span> <span class='symbol val'>:type</span> <span class='rbrack token'>]</span>
  <span class='missing_metadata identifier id'>missing_metadata</span>  <span class='assign token'>=</span> <span class='required_metadata identifier id'>required_metadata</span> <span class='minus op'>-</span> <span class='lparen token'>(</span><span class='required_metadata identifier id'>required_metadata</span> <span class='bitand op'>&amp;</span> <span class='metadata identifier id'>metadata</span><span class='dot token'>.</span><span class='keys identifier id'>keys</span><span class='rparen token'>)</span>

  <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;Can't store data package, missing information for #{missing_metadata.join(', ')}&quot;</span>         <span class='unless unless_mod kw'>unless</span> <span class='missing_metadata identifier id'>missing_metadata</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
  <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;Can't store package #{metadata[:name]}, it already exists&quot;</span>                                    <span class='if if_mod kw'>if</span> <span class='exists? fid id'>exists?</span> <span class='metadata identifier id'>metadata</span><span class='lbrack token'>[</span><span class='symbol val'>:name</span><span class='rbrack token'>]</span>
  <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;Can't store package using name #{metadata[:name]}, it's been previously created and deleted&quot;</span>  <span class='if if_mod kw'>if</span> <span class='was_deleted? fid id'>was_deleted?</span> <span class='metadata identifier id'>metadata</span><span class='lbrack token'>[</span><span class='symbol val'>:name</span><span class='rbrack token'>]</span>

  <span class='pkg identifier id'>pkg</span> <span class='assign token'>=</span> <span class='create identifier id'>create</span><span class='lparen token'>(</span><span class='symbol val'>:name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='metadata identifier id'>metadata</span><span class='lbrack token'>[</span><span class='symbol val'>:name</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='symbol val'>:ieid</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='metadata identifier id'>metadata</span><span class='lbrack token'>[</span><span class='symbol val'>:ieid</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>

  <span class='begin begin kw'>begin</span>
    <span class='Pool constant id'>Pool</span><span class='dot token'>.</span><span class='list_active identifier id'>list_active</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='pool identifier id'>pool</span><span class='bitor op'>|</span>
      <span class='location identifier id'>location</span> <span class='assign token'>=</span> <span class='pkg identifier id'>pkg</span><span class='dot token'>.</span><span class='store_copy identifier id'>store_copy</span><span class='lparen token'>(</span><span class='data_io identifier id'>data_io</span><span class='comma token'>,</span> <span class='pool identifier id'>pool</span><span class='dot token'>.</span><span class='post_url identifier id'>post_url</span><span class='lparen token'>(</span><span class='pkg identifier id'>pkg</span><span class='dot token'>.</span><span class='name identifier id'>name</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='metadata identifier id'>metadata</span><span class='rparen token'>)</span>
      <span class='pkg identifier id'>pkg</span><span class='dot token'>.</span><span class='copies identifier id'>copies</span> <span class='lshft op'>&lt;&lt;</span> <span class='Copy constant id'>Copy</span><span class='dot token'>.</span><span class='create identifier id'>create</span><span class='lparen token'>(</span><span class='symbol val'>:store_location</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='location identifier id'>location</span><span class='comma token'>,</span> <span class='symbol val'>:pool</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='pool identifier id'>pool</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>

  <span class='rescue rescue kw'>rescue</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e1 identifier id'>e1</span>
    <span class='msg identifier id'>msg</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;Failure storing a copy of #{metadata[:name]}: #{e1.message}&quot;</span>
    <span class='pkg identifier id'>pkg</span><span class='dot token'>.</span><span class='locations identifier id'>locations</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='loc identifier id'>loc</span><span class='bitor op'>|</span>
      <span class='begin begin kw'>begin</span>
        <span class='pkg identifier id'>pkg</span><span class='dot token'>.</span><span class='delete_copy identifier id'>delete_copy</span><span class='lparen token'>(</span><span class='loc identifier id'>loc</span><span class='rparen token'>)</span>
      <span class='rescue rescue kw'>rescue</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e2 identifier id'>e2</span>
        <span class='msg identifier id'>msg</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot;; also, failed in cleanup, when trying to delete copy at #{loc}: #{e2.message}&quot;</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
    <span class='pkg identifier id'>pkg</span><span class='dot token'>.</span><span class='destroy identifier id'>destroy</span> <span class='if if_mod kw'>if</span> <span class='pkg identifier id'>pkg</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span> <span class='symbol val'>:destroy</span>
    <span class='raise identifier id'>raise</span> <span class='e1 identifier id'>e1</span><span class='comma token'>,</span> <span class='msg identifier id'>msg</span>
  <span class='end end kw'>end</span>

  <span class='if if kw'>if</span> <span class='not not kw'>not</span> <span class='pkg identifier id'>pkg</span><span class='dot token'>.</span><span class='save identifier id'>save</span>
    <span class='msg identifier id'>msg</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;DB error recording #{name} - #{pkg.errors.full_messages.join('; ')}&quot;</span>
    <span class='pkg identifier id'>pkg</span><span class='dot token'>.</span><span class='locations identifier id'>locations</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='loc identifier id'>loc</span><span class='bitor op'>|</span>
      <span class='begin begin kw'>begin</span>
        <span class='pkg identifier id'>pkg</span><span class='dot token'>.</span><span class='delete_copy identifier id'>delete_copy</span><span class='lparen token'>(</span><span class='loc identifier id'>loc</span><span class='rparen token'>)</span>
      <span class='rescue rescue kw'>rescue</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
        <span class='msg identifier id'>msg</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot;; also, failed in cleanup, when trying to delete copy at #{loc}: #{e.message}&quot;</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
    <span class='raise identifier id'>raise</span> <span class='DataBaseError constant id'>DataBaseError</span><span class='comma token'>,</span> <span class='msg identifier id'>msg</span>
  <span class='end end kw'>end</span>
  <span class='pkg identifier id'>pkg</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="was_deleted?-class_method">
  
    + (<tt>Boolean</tt>) <strong>was_deleted?</strong>(name) 
  

  
</p><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


30
31
32</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/store-master/lib/store-master/data-model/packages.rb', line 30</span>

<span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='was_deleted? fid id'>was_deleted?</span> <span class='name identifier id'>name</span>
  <span class='not not kw'>not</span> <span class='first identifier id'>first</span><span class='lparen token'>(</span><span class='symbol val'>:name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='symbol val'>:extant</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='false false kw'>false</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="delete-instance_method">
  
    - (<tt>Object</tt>) <strong>delete</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
on failure may leave orphan
</p>


  </div>
</div>
<div class="tags">
  <h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="../StoreMaster/DataBaseError.html" title="StoreMaster::DataBaseError (class)">DataBaseError</a></span></tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


91
92
93
94
95
96
97
98
99
100
101
102
103
104
105</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/store-master/lib/store-master/data-model/packages.rb', line 91</span>

<span class='def def kw'>def</span> <span class='delete identifier id'>delete</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='extant identifier id'>extant</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>
  <span class='raise identifier id'>raise</span>  <span class='DataBaseError constant id'>DataBaseError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;error deleting #{self.name} - #{self.errors.full_messages.join('; ')}&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='save identifier id'>save</span>

  <span class='errs identifier id'>errs</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='locations identifier id'>locations</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='loc identifier id'>loc</span><span class='bitor op'>|</span>
    <span class='begin begin kw'>begin</span>
      <span class='delete_copy identifier id'>delete_copy</span><span class='lparen token'>(</span><span class='loc identifier id'>loc</span><span class='rparen token'>)</span>
    <span class='rescue rescue kw'>rescue</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
      <span class='errs identifier id'>errs</span><span class='dot token'>.</span><span class='push identifier id'>push</span> <span class='dstring node'>&quot;failed to delete storage at #{loc.sanitized}: #{e.message}&quot;</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='raise identifier id'>raise</span> <span class='DriveByError constant id'>DriveByError</span><span class='comma token'>,</span> <span class='errs identifier id'>errs</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>'; '</span><span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='errs identifier id'>errs</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="delete_copy-instance_method">
  
    - (<tt>Object</tt>) <strong>delete_copy</strong>(silo_resource) 
  

  
</p><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  <h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="../StoreMaster/SiloStoreError.html" title="StoreMaster::SiloStoreError (class)">SiloStoreError</a></span></tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


160
161
162
163
164
165
166
167
168
169
170
171
172
173</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/store-master/lib/store-master/data-model/packages.rb', line 160</span>

<span class='def def kw'>def</span> <span class='delete_copy identifier id'>delete_copy</span> <span class='silo_resource identifier id'>silo_resource</span>

  <span class='http identifier id'>http</span> <span class='assign token'>=</span> <span class='Net constant id'>Net</span><span class='colon2 op'>::</span><span class='HTTP constant id'>HTTP</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='silo_resource identifier id'>silo_resource</span><span class='dot token'>.</span><span class='host identifier id'>host</span><span class='comma token'>,</span> <span class='silo_resource identifier id'>silo_resource</span><span class='dot token'>.</span><span class='port identifier id'>port</span><span class='rparen token'>)</span>
  <span class='http identifier id'>http</span><span class='dot token'>.</span><span class='open_timeout identifier id'>open_timeout</span> <span class='assign token'>=</span> <span class='integer val'>30</span>
  <span class='http identifier id'>http</span><span class='dot token'>.</span><span class='read_timeout identifier id'>read_timeout</span> <span class='assign token'>=</span> <span class='integer val'>60</span> <span class='mult op'>*</span> <span class='integer val'>5</span>  <span class='comment val'># deletes can take some time for large packages on active filesystems</span>

  <span class='request identifier id'>request</span> <span class='assign token'>=</span> <span class='Net constant id'>Net</span><span class='colon2 op'>::</span><span class='HTTP constant id'>HTTP</span><span class='colon2 op'>::</span><span class='Delete constant id'>Delete</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='silo_resource identifier id'>silo_resource</span><span class='dot token'>.</span><span class='request_uri identifier id'>request_uri</span><span class='rparen token'>)</span>
  <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='basic_auth identifier id'>basic_auth</span><span class='lparen token'>(</span><span class='silo_resource identifier id'>silo_resource</span><span class='dot token'>.</span><span class='user identifier id'>user</span><span class='comma token'>,</span> <span class='silo_resource identifier id'>silo_resource</span><span class='dot token'>.</span><span class='password identifier id'>password</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='silo_resource identifier id'>silo_resource</span><span class='dot token'>.</span><span class='user identifier id'>user</span> <span class='or or kw'>or</span> <span class='silo_resource identifier id'>silo_resource</span><span class='dot token'>.</span><span class='password identifier id'>password</span>

  <span class='response identifier id'>response</span> <span class='assign token'>=</span> <span class='http identifier id'>http</span><span class='dot token'>.</span><span class='request identifier id'>request</span><span class='lparen token'>(</span><span class='request identifier id'>request</span><span class='rparen token'>)</span>
  <span class='status identifier id'>status</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='code identifier id'>code</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>

  <span class='raise identifier id'>raise</span> <span class='SiloStoreError constant id'>SiloStoreError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;#{response.code} #{response.message} was returned for a failed delete of the package copy at #{silo_resource.sanitized} - #{response.body}&quot;</span> <span class='if if_mod kw'>if</span> <span class='status identifier id'>status</span> <span class='geq op'>&gt;=</span> <span class='integer val'>300</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="locations-instance_method">
  
    - (<tt>Object</tt>) <strong>locations</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
return URI objects for all of the copies we have, in pool-preference order
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


22
23
24</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/store-master/lib/store-master/data-model/packages.rb', line 22</span>

<span class='def def kw'>def</span> <span class='locations identifier id'>locations</span>
  <span class='copies identifier id'>copies</span><span class='dot token'>.</span><span class='sort identifier id'>sort</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='a identifier id'>a</span><span class='comma token'>,</span><span class='b identifier id'>b</span><span class='bitor op'>|</span> <span class='b identifier id'>b</span><span class='dot token'>.</span><span class='pool identifier id'>pool</span><span class='dot token'>.</span><span class='read_preference identifier id'>read_preference</span> <span class='cmp op'>&lt;=&gt;</span> <span class='a identifier id'>a</span><span class='dot token'>.</span><span class='pool identifier id'>pool</span><span class='dot token'>.</span><span class='read_preference identifier id'>read_preference</span> <span class='rbrace token'>}</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='copy identifier id'>copy</span><span class='bitor op'>|</span> <span class='copy identifier id'>copy</span><span class='dot token'>.</span><span class='url identifier id'>url</span> <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="store_copy-instance_method">
  
    - (<tt>Object</tt>) <strong>store_copy</strong>(io, posting_url, metadata) 
  

  
</p><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  <h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
        <span class='type'>(<tt><span class='object_link'><a href="../StoreMaster/SiloStoreError.html" title="StoreMaster::SiloStoreError (class)">SiloStoreError</a></span></tt>)</span>
      
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/store-master/lib/store-master/data-model/packages.rb', line 107</span>

<span class='def def kw'>def</span> <span class='store_copy identifier id'>store_copy</span> <span class='io identifier id'>io</span><span class='comma token'>,</span> <span class='posting_url identifier id'>posting_url</span><span class='comma token'>,</span> <span class='metadata identifier id'>metadata</span>

  <span class='comment val'># Note: posting_url may have credentials, be sure to use sanitized method on it.</span>

  <span class='http identifier id'>http</span> <span class='assign token'>=</span> <span class='Net constant id'>Net</span><span class='colon2 op'>::</span><span class='HTTP constant id'>HTTP</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='posting_url identifier id'>posting_url</span><span class='dot token'>.</span><span class='host identifier id'>host</span><span class='comma token'>,</span> <span class='posting_url identifier id'>posting_url</span><span class='dot token'>.</span><span class='port identifier id'>port</span><span class='rparen token'>)</span>
  <span class='http identifier id'>http</span><span class='dot token'>.</span><span class='open_timeout identifier id'>open_timeout</span> <span class='assign token'>=</span> <span class='integer val'>60</span> <span class='mult op'>*</span> <span class='integer val'>2</span>
  <span class='http identifier id'>http</span><span class='dot token'>.</span><span class='read_timeout identifier id'>read_timeout</span> <span class='assign token'>=</span> <span class='integer val'>60</span> <span class='mult op'>*</span> <span class='integer val'>2</span>
  <span class='request identifier id'>request</span> <span class='assign token'>=</span> <span class='Net constant id'>Net</span><span class='colon2 op'>::</span><span class='HTTP constant id'>HTTP</span><span class='colon2 op'>::</span><span class='Post constant id'>Post</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='posting_url identifier id'>posting_url</span><span class='dot token'>.</span><span class='request_uri identifier id'>request_uri</span><span class='rparen token'>)</span>
  <span class='io identifier id'>io</span><span class='dot token'>.</span><span class='rewind identifier id'>rewind</span> <span class='if if_mod kw'>if</span> <span class='io identifier id'>io</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='string val'>'rewind'</span><span class='rparen token'>)</span>
  <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='body_stream identifier id'>body_stream</span> <span class='assign token'>=</span> <span class='io identifier id'>io</span>
  <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='initialize_http_header identifier id'>initialize_http_header</span><span class='lparen token'>(</span><span class='string val'>&quot;Content-MD5&quot;</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='StoreUtils constant id'>StoreUtils</span><span class='dot token'>.</span><span class='md5hex_to_base64 identifier id'>md5hex_to_base64</span><span class='lparen token'>(</span><span class='metadata identifier id'>metadata</span><span class='lbrack token'>[</span><span class='symbol val'>:md5</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='string val'>&quot;Content-Length&quot;</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='metadata identifier id'>metadata</span><span class='lbrack token'>[</span><span class='symbol val'>:size</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='comma token'>,</span> <span class='string val'>&quot;Content-Type&quot;</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='metadata identifier id'>metadata</span><span class='lbrack token'>[</span><span class='symbol val'>:type</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
  <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='basic_auth identifier id'>basic_auth</span><span class='lparen token'>(</span><span class='posting_url identifier id'>posting_url</span><span class='dot token'>.</span><span class='user identifier id'>user</span><span class='comma token'>,</span> <span class='posting_url identifier id'>posting_url</span><span class='dot token'>.</span><span class='password identifier id'>password</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='posting_url identifier id'>posting_url</span><span class='dot token'>.</span><span class='user identifier id'>user</span> <span class='or or kw'>or</span> <span class='posting_url identifier id'>posting_url</span><span class='dot token'>.</span><span class='password identifier id'>password</span>
  <span class='response identifier id'>response</span> <span class='assign token'>=</span> <span class='http identifier id'>http</span><span class='dot token'>.</span><span class='request identifier id'>request</span><span class='lparen token'>(</span><span class='request identifier id'>request</span><span class='rparen token'>)</span>
  <span class='status identifier id'>status</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='code identifier id'>code</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>

  <span class='raise identifier id'>raise</span><span class='lparen token'>(</span><span class='SiloStoreError constant id'>SiloStoreError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;#{response.code} #{response.message} - when saving package #{metadata[:name]} to silo #{posting_url.sanitized} - #{response.body}&quot;</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='status identifier id'>status</span> <span class='geq op'>&gt;=</span> <span class='integer val'>300</span>

  <span class='comment val'># Example XML document returned from POST, giving details about the resource</span>
  <span class='comment val'># </span>
  <span class='comment val'>#   &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;                              </span>
  <span class='comment val'>#   &lt;created type=&quot;application/x-tar&quot;                                                                            </span>
  <span class='comment val'>#            time=&quot;2010-10-21T10:29:19-04:00&quot;                                                                    </span>
  <span class='comment val'>#            sha1=&quot;ac4d813081e066422bc1dc7e7997ace1bfb858b2&quot;                                                     </span>
  <span class='comment val'>#            etag=&quot;a3f07bc57127112f2a2c40d026b1abe1&quot;                                                             </span>
  <span class='comment val'>#            md5=&quot;32e2ce3af2f98a115e121285d042c9bd&quot;                                                              </span>
  <span class='comment val'>#            size=&quot;6031360&quot;                                                                                      </span>
  <span class='comment val'>#            location=&quot;http://storage.local/b/data/E20101021_LJLAMU.001&quot;                                         </span>
  <span class='comment val'>#            name=&quot;E20101021_LJLAMU.001&quot;/&gt;</span>

  <span class='returned_data identifier id'>returned_data</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='begin begin kw'>begin</span>
    <span class='parser identifier id'>parser</span> <span class='assign token'>=</span> <span class='XML constant id'>XML</span><span class='colon2 op'>::</span><span class='Parser constant id'>Parser</span><span class='dot token'>.</span><span class='string identifier id'>string</span><span class='lparen token'>(</span><span class='response identifier id'>response</span><span class='dot token'>.</span><span class='body identifier id'>body</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='parse identifier id'>parse</span>
    <span class='parser identifier id'>parser</span><span class='dot token'>.</span><span class='find identifier id'>find</span><span class='lparen token'>(</span><span class='string val'>'/created'</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='each_attr identifier id'>each_attr</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='attr identifier id'>attr</span><span class='bitor op'>|</span> <span class='returned_data identifier id'>returned_data</span><span class='lbrack token'>[</span><span class='attr identifier id'>attr</span><span class='dot token'>.</span><span class='name identifier id'>name</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='attr identifier id'>attr</span><span class='dot token'>.</span><span class='value identifier id'>value</span> <span class='rbrace token'>}</span>
  <span class='rescue rescue kw'>rescue</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
    <span class='raise identifier id'>raise</span> <span class='SiloStoreError constant id'>SiloStoreError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Invalid XML document returned when saving package to #{posting_url.sanitized}: #{e.message}&quot;</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># check the md5, size, type vs. our request to that returned by remotely created copy.</span>

  <span class='raise identifier id'>raise</span> <span class='SiloStoreError constant id'>SiloStoreError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Error storing to #{posting_url.sanitized} - md5 mismatch&quot;</span>   <span class='if if_mod kw'>if</span> <span class='returned_data identifier id'>returned_data</span><span class='lbrack token'>[</span><span class='string val'>&quot;md5&quot;</span><span class='rbrack token'>]</span>  <span class='neq op'>!=</span> <span class='metadata identifier id'>metadata</span><span class='lbrack token'>[</span><span class='symbol val'>:md5</span><span class='rbrack token'>]</span>
  <span class='raise identifier id'>raise</span> <span class='SiloStoreError constant id'>SiloStoreError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Error storing to #{posting_url.sanitized} - size mismatch&quot;</span>  <span class='if if_mod kw'>if</span> <span class='returned_data identifier id'>returned_data</span><span class='lbrack token'>[</span><span class='string val'>&quot;size&quot;</span><span class='rbrack token'>]</span> <span class='neq op'>!=</span> <span class='metadata identifier id'>metadata</span><span class='lbrack token'>[</span><span class='symbol val'>:size</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
  <span class='raise identifier id'>raise</span> <span class='SiloStoreError constant id'>SiloStoreError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Error storing to #{posting_url.sanitized} - type mismatch&quot;</span>  <span class='if if_mod kw'>if</span> <span class='returned_data identifier id'>returned_data</span><span class='lbrack token'>[</span><span class='string val'>&quot;type&quot;</span><span class='rbrack token'>]</span> <span class='neq op'>!=</span> <span class='metadata identifier id'>metadata</span><span class='lbrack token'>[</span><span class='symbol val'>:type</span><span class='rbrack token'>]</span>

  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='md5 identifier id'>md5</span>  <span class='assign token'>=</span> <span class='returned_data identifier id'>returned_data</span><span class='lbrack token'>[</span><span class='string val'>'md5'</span><span class='rbrack token'>]</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='sha1 identifier id'>sha1</span> <span class='assign token'>=</span> <span class='returned_data identifier id'>returned_data</span><span class='lbrack token'>[</span><span class='string val'>'sha1'</span><span class='rbrack token'>]</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='type identifier id'>type</span> <span class='assign token'>=</span> <span class='returned_data identifier id'>returned_data</span><span class='lbrack token'>[</span><span class='string val'>'type'</span><span class='rbrack token'>]</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='assign token'>=</span> <span class='returned_data identifier id'>returned_data</span><span class='lbrack token'>[</span><span class='string val'>'size'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='etag identifier id'>etag</span> <span class='assign token'>=</span> <span class='returned_data identifier id'>returned_data</span><span class='lbrack token'>[</span><span class='string val'>'etag'</span><span class='rbrack token'>]</span>

  <span class='returned_data identifier id'>returned_data</span><span class='lbrack token'>[</span><span class='string val'>'location'</span><span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Sat Jan 22 16:40:15 2011 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.6.0 (ruby-1.8.7).
</div>

  </body>
</html>