<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta name="Content-Type" content="text/html; charset=utf-8" />
<title>Class: Analyzer::IntraPoolAnalyzer</title>
<link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '..';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/app.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (I)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../Analyzer.html" title="Analyzer (module)">Analyzer</a></span></span>
     &raquo; 
    <span class="title">IntraPoolAnalyzer</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: Analyzer::IntraPoolAnalyzer
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Analyzer::IntraPoolAnalyzer</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">/Users/fischer/WorkProjects/daitss2/store-master/lib/store-master/fixity/analyzer.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>
IntraPoolAnalyzer
</p>
<p>
Initialize with an array of streams, one for each of our pools. Check each
pool for internal consistency, which here means we have exacly one fixity
record for each package (no redundant packages in a silo-pool)
</p>


  </div>
</div>
<div class="tags">
  
</div>

  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#reports-instance_method" title="#reports (instance method)">- (Object) <strong>reports</strong> </a>
    

    
  </span>
  
  
    <span class="note title readonly">readonly</span>
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Recall that each of the PoolFixityStreamss given to us yield key/value
pairs: <String::package>, <Struct::PoolFixityRecord>, e.g.
</p>
</div></span>
  
</li>

    
  </ul>


  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (IntraPoolAnalyzer) <strong>initialize</strong>(pool_fixity_streams, max_days) </a>
    

    
  </span>
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
A new instance of IntraPoolAnalyzer.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#run-instance_method" title="#run (instance method)">- (Object) <strong>run</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <p class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Analyzer::IntraPoolAnalyzer (class)">IntraPoolAnalyzer</a></span></tt>) <strong>initialize</strong>(pool_fixity_streams, max_days) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
A new instance of IntraPoolAnalyzer
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


35
36
37
38
39
40
41
42
43
44</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/store-master/lib/store-master/fixity/analyzer.rb', line 35</span>

<span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span> <span class='pool_fixity_streams identifier id'>pool_fixity_streams</span><span class='comma token'>,</span> <span class='max_days identifier id'>max_days</span>
  <span class='@expiration_date ivar id'>@expiration_date</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='DateTime constant id'>DateTime</span><span class='dot token'>.</span><span class='now identifier id'>now</span> <span class='minus op'>-</span> <span class='max_days identifier id'>max_days</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
  <span class='@pool_fixity_streams ivar id'>@pool_fixity_streams</span>  <span class='assign token'>=</span> <span class='pool_fixity_streams identifier id'>pool_fixity_streams</span>

  <span class='@redundant_package_report ivar id'>@redundant_package_report</span> <span class='assign token'>=</span> <span class='Reporter constant id'>Reporter</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='string val'>&quot;Per-Pool Redundancy Report&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;Multiple Copies Within A Pool&quot;</span><span class='rparen token'>)</span>
  <span class='@expired_fixity_report ivar id'>@expired_fixity_report</span>    <span class='assign token'>=</span> <span class='Reporter constant id'>Reporter</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='string val'>&quot;Per-Pool Expiration Report&quot;</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Packages With Expired Fixities - Older Than #{max_days} Days&quot;</span><span class='rparen token'>)</span>
  <span class='@bad_status_report ivar id'>@bad_status_report</span>        <span class='assign token'>=</span> <span class='Reporter constant id'>Reporter</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='string val'>&quot;Per-Pool Status Report&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;Packages Currently Marked With Failed Fixity&quot;</span><span class='rparen token'>)</span>

  <span class='@reports ivar id'>@reports</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span> <span class='@redundant_package_report ivar id'>@redundant_package_report</span><span class='comma token'>,</span> <span class='@expired_fixity_report ivar id'>@expired_fixity_report</span><span class='comma token'>,</span> <span class='@bad_status_report ivar id'>@bad_status_report</span> <span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <span id="reports-instance_method"></span>
      <div class="method_details first">
  <p class="signature first" id="reports-instance_method">
  
    - (<tt>Object</tt>) <strong>reports</strong>  <span class="extras">(readonly)</span>
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Recall that each of the PoolFixityStreamss given to us yield key/value
pairs: <String::package>, <Struct::PoolFixityRecord>, e.g.
</p>
<pre class="code">
 <span class='EO05UJJHZ_HPDFHG constant id'>EO05UJJHZ_HPDFHG</span><span class='integer val'>.001</span> <span class='comment val'>#&lt;struct Struct::PoolFixityRecord location=&quot;http://silos.ripple.fcla.edu:70/001/data/EO05UJJHZ_HPDFHG.001&quot;, sha1=&quot;4abc7ec5f02b946dc4812f0b60bda34940ae62f3&quot;, md5=&quot;0d736ef6585b44bf0552a61b95ad9b87&quot;, size=&quot;1313843200&quot;, fixity_time=&quot;2011-04-27T11:38:30Z&quot;, put_time=&quot;2011-04-20T20:21:33Z&quot;, status=&quot;ok&quot;&gt;</span>
</pre>
<p>
All fields within the struct are simple strings.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


33
34
35</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/store-master/lib/store-master/fixity/analyzer.rb', line 33</span>

<span class='def def kw'>def</span> <span class='reports identifier id'>reports</span>
  <span class='@reports ivar id'>@reports</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="run-instance_method">
  
    - (<tt>Object</tt>) <strong>run</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/store-master/lib/store-master/fixity/analyzer.rb', line 46</span>

<span class='def def kw'>def</span> <span class='run identifier id'>run</span>
  <span class='@pool_fixity_streams ivar id'>@pool_fixity_streams</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='pool_fixity_stream identifier id'>pool_fixity_stream</span><span class='bitor op'>|</span>

    <span class='pool_fixity_stream identifier id'>pool_fixity_stream</span><span class='dot token'>.</span><span class='rewind identifier id'>rewind</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='package_name identifier id'>package_name</span><span class='comma token'>,</span> <span class='fixity_record identifier id'>fixity_record</span><span class='bitor op'>|</span>
      <span class='if if kw'>if</span> <span class='fixity_record identifier id'>fixity_record</span><span class='dot token'>.</span><span class='status identifier id'>status</span> <span class='neq op'>!=</span> <span class='string val'>'ok'</span>
        <span class='@bad_status_report ivar id'>@bad_status_report</span><span class='dot token'>.</span><span class='err identifier id'>err</span> <span class='dstring node'>&quot;#{fixity_record.location} fixity status of '#{fixity_record.status}' as of  #{Time.parse(fixity_record.timestamp)}&quot;</span>
      <span class='end end kw'>end</span>

      <span class='if if kw'>if</span> <span class='fixity_record identifier id'>fixity_record</span><span class='dot token'>.</span><span class='timestamp identifier id'>timestamp</span> <span class='lt op'>&lt;</span> <span class='@expiration_date ivar id'>@expiration_date</span>
        <span class='days identifier id'>days</span> <span class='assign token'>=</span> <span class='string val'>'%3.1f'</span> <span class='mod op'>%</span> <span class='lparen token'>(</span><span class='lparen token'>(</span><span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='parse identifier id'>parse</span><span class='lparen token'>(</span><span class='@expiration_date ivar id'>@expiration_date</span><span class='rparen token'>)</span> <span class='minus op'>-</span> <span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='parse identifier id'>parse</span><span class='lparen token'>(</span><span class='fixity_record identifier id'>fixity_record</span><span class='dot token'>.</span><span class='timestamp identifier id'>timestamp</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='div op'>/</span><span class='lparen token'>(</span><span class='integer val'>60</span> <span class='mult op'>*</span> <span class='integer val'>60</span> <span class='mult op'>*</span> <span class='integer val'>24</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
        <span class='@expired_fixity_report ivar id'>@expired_fixity_report</span><span class='dot token'>.</span><span class='warn identifier id'>warn</span> <span class='dstring node'>&quot;#{fixity_record.location} fixity expired #{days} #{FixityUtils.pluralize(days,'day ago', 'days ago')}&quot;</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='@pool_fixity_streams ivar id'>@pool_fixity_streams</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='pool_fixity_stream identifier id'>pool_fixity_stream</span><span class='bitor op'>|</span>
    <span class='Streams constant id'>Streams</span><span class='colon2 op'>::</span><span class='FoldedStream constant id'>FoldedStream</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='pool_fixity_stream identifier id'>pool_fixity_stream</span><span class='dot token'>.</span><span class='rewind identifier id'>rewind</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='package_name identifier id'>package_name</span><span class='comma token'>,</span> <span class='fixity_records identifier id'>fixity_records</span><span class='bitor op'>|</span>      <span class='comment val'># fold values for identical keys into one array</span>
      <span class='if if kw'>if</span> <span class='fixity_records identifier id'>fixity_records</span><span class='dot token'>.</span><span class='count identifier id'>count</span> <span class='gt op'>&gt;</span> <span class='integer val'>1</span>
        <span class='@redundant_package_report ivar id'>@redundant_package_report</span><span class='dot token'>.</span><span class='warn identifier id'>warn</span> <span class='dstring node'>&quot;#{package_name} #{fixity_records.map { |rec| rec.location }.join(', ')}&quot;</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='@reports ivar id'>@reports</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='report identifier id'>report</span><span class='bitor op'>|</span> <span class='report identifier id'>report</span><span class='dot token'>.</span><span class='done identifier id'>done</span> <span class='rbrace token'>}</span>
  <span class='self self kw'>self</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Thu May 12 23:37:24 2011 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.6.0 (ruby-1.8.7).
</div>

  </body>
</html>