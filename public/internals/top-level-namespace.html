<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Top Level Namespace
  
    &mdash; Storage Master Service
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '';
  if (relpath != '') relpath += '/';
</script>

  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    
    
    <span class="title">Top Level Namespace</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a id="class_list_link" href="#">Class List</a>
  
    <a id="method_list_link" href="#">Method List</a>
  
    <a id="file_list_link" href="#">File List</a>
  
</div>
      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Top Level Namespace
  
  
  
</h1>

<dl class="box">
  
  
    
  
    
      <dt class="r1">Includes:</dt>
      <dd class="r1">Datyl, <span class='object_link'><a href="StorageMaster.html" title="StorageMaster (module)">StorageMaster</a></span>, <span class='object_link'><a href="StorageMasterModel.html" title="StorageMasterModel (module)">StorageMasterModel</a></span></dd>
      
    
  
  
  
</dl>
<div class="clear"></div>

<h2>Defined Under Namespace</h2>
<p class="children">
   
    
      <strong class="modules">Modules:</strong> <span class='object_link'><a href="Analyzer.html" title="Analyzer (module)">Analyzer</a></span>, <span class='object_link'><a href="Daitss.html" title="Daitss (module)">Daitss</a></span>, <span class='object_link'><a href="FixityUtils.html" title="FixityUtils (module)">FixityUtils</a></span>, <span class='object_link'><a href="StorageMaster.html" title="StorageMaster (module)">StorageMaster</a></span>, <span class='object_link'><a href="StorageMasterModel.html" title="StorageMasterModel (module)">StorageMasterModel</a></span>, <span class='object_link'><a href="StoreUtils.html" title="StoreUtils (module)">StoreUtils</a></span>, <span class='object_link'><a href="Streams.html" title="Streams (module)">Streams</a></span>, <span class='object_link'><a href="URI.html" title="URI (module)">URI</a></span>
    
   
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="DateTime.html" title="DateTime (class)">DateTime</a></span>
    
  
</p>

  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="SEARCH_RESULTS_LIMIT-constant" class="">SEARCH_RESULTS_LIMIT =
          
        </dt>
        <dd><pre class="code"><span class='integer val'>50</span>
</pre></dd>
      
        <dt id="PASSWORD_SENTINEL-constant" class="">PASSWORD_SENTINEL =
          <div class="docstring">
  <div class="discussion">
    
<p>we don’t have access to the original password; we use this to indicate a
password is set in the forms</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='string val'>'*'</span> <span class='mult op'>*</span> <span class='integer val'>16</span>
</pre></dd>
      
    </dl>
  


  
  
  
  
  
  <h3 class="inherited">Constants included from <span class='object_link'><a href="StorageMasterModel.html" title="StorageMasterModel (module)">StorageMasterModel</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="StorageMasterModel.html#OPEN_TIMEOUT-constant" title="StorageMasterModel::OPEN_TIMEOUT (constant)">OPEN_TIMEOUT</a></span>, <span class='object_link'><a href="StorageMasterModel.html#READ_TIMEOUT-constant" title="StorageMasterModel::READ_TIMEOUT (constant)">READ_TIMEOUT</a></span></p>

  
  
  
  
  <h3 class="inherited">Constants included from <span class='object_link'><a href="StorageMaster.html" title="StorageMaster (module)">StorageMaster</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="StorageMaster.html#NAME-constant" title="StorageMaster::NAME (constant)">NAME</a></span>, <span class='object_link'><a href="StorageMaster.html#RELEASE-constant" title="StorageMaster::RELEASE (constant)">RELEASE</a></span>, <span class='object_link'><a href="StorageMaster.html#REVISION-constant" title="StorageMaster::REVISION (constant)">REVISION</a></span>, <span class='object_link'><a href="StorageMaster.html#VERSION-constant" title="StorageMaster::VERSION (constant)">VERSION</a></span></p>



  
  
  
  
  
  
  

  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_capistrano_git_revision-instance_method" title="#get_capistrano_git_revision (instance method)">- (Object) <strong>get_capistrano_git_revision</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>When we deploy with Capistrano it checks out the code using Git into its
own branch, and places the git revision hash into the ‘REVISION’ file.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_capistrano_release-instance_method" title="#get_capistrano_release (instance method)">- (Object) <strong>get_capistrano_release</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>When we deploy with Capistrano, it places a newly checked out version of
the code into a directory created under ../releases/, with names such as
20100516175736.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_config-instance_method" title="#get_config (instance method)">- (Object) <strong>get_config</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="StorageMasterModel.html" title="StorageMasterModel (module)">StorageMasterModel</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="StorageMasterModel.html#create_tables-class_method" title="StorageMasterModel.create_tables (method)">create_tables</a></span>, <span class='object_link'><a href="StorageMasterModel.html#patch_tables-class_method" title="StorageMasterModel.patch_tables (method)">patch_tables</a></span>, <span class='object_link'><a href="StorageMasterModel.html#setup_db-class_method" title="StorageMasterModel.setup_db (method)">setup_db</a></span>, <span class='object_link'><a href="StorageMasterModel.html#tables-class_method" title="StorageMasterModel.tables (method)">tables</a></span>, <span class='object_link'><a href="StorageMasterModel.html#update_tables-class_method" title="StorageMasterModel.update_tables (method)">update_tables</a></span></p>

  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="StorageMaster.html" title="StorageMaster (module)">StorageMaster</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="StorageMaster.html#setup_databases-class_method" title="StorageMaster.setup_databases (method)">setup_databases</a></span>, <span class='object_link'><a href="StorageMaster.html#version-class_method" title="StorageMaster.version (method)">version</a></span></p>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="get_capistrano_git_revision-instance_method">
  
    - (<tt>Object</tt>) <strong>get_capistrano_git_revision</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>When we deploy with Capistrano it checks out the code using Git into its
own branch, and places the git revision hash into the ‘REVISION’ file. 
Here we search for that file, and if found, return its contents.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


27
28
29
30</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/storage-master/lib/storage-master.rb', line 27</span>

<span class='def def kw'>def</span> <span class='get_capistrano_git_revision identifier id'>get_capistrano_git_revision</span>
  <span class='revision_file identifier id'>revision_file</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='expand_path identifier id'>expand_path</span><span class='lparen token'>(</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='dirname identifier id'>dirname</span><span class='lparen token'>(</span><span class='__FILE__ __file__ kw'>__FILE__</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='string val'>'..'</span><span class='comma token'>,</span> <span class='string val'>'REVISION'</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='File constant id'>File</span><span class='dot token'>.</span><span class='exists? fid id'>exists?</span><span class='lparen token'>(</span><span class='revision_file identifier id'>revision_file</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='readlines identifier id'>readlines</span><span class='lparen token'>(</span><span class='revision_file identifier id'>revision_file</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='chomp identifier id'>chomp</span> <span class='colon op'>:</span> <span class='string val'>'Unknown'</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="get_capistrano_release-instance_method">
  
    - (<tt>Object</tt>) <strong>get_capistrano_release</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>When we deploy with Capistrano, it places a newly checked out version of
the code into a directory created under ../releases/, with names such as
20100516175736.  Now this is a nice thing, since these directories are
backed up in the normal course of events: we’d like to include this
release number in our service version information so we can easily locate
the specific version of the code, if need be, in the future.</p>

<p>Note that this release information is more specific than a git release; it
includes configuration information that may not be checked in.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


44
45
46
47</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/Users/fischer/WorkProjects/daitss2/storage-master/lib/storage-master.rb', line 44</span>

<span class='def def kw'>def</span> <span class='get_capistrano_release identifier id'>get_capistrano_release</span>
  <span class='full_path identifier id'>full_path</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='expand_path identifier id'>expand_path</span><span class='lparen token'>(</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='dirname identifier id'>dirname</span><span class='lparen token'>(</span><span class='__FILE__ __file__ kw'>__FILE__</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='lparen token'>(</span><span class='full_path identifier id'>full_path</span> <span class='match op'>=~</span> <span class='regexp val'>%r{/releases/((\d+){14})/}</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='$1 nth_ref id'>$1</span> <span class='colon op'>:</span> <span class='string val'>&quot;Not Available&quot;</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="get_config-instance_method">
  
    - (<tt>Object</tt>) <strong>get_config</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="StorageMaster/ConfigurationError.html" title="StorageMaster::ConfigurationError (class)">ConfigurationError</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app.rb', line 17</span>

<span class='def def kw'>def</span> <span class='get_config identifier id'>get_config</span>
  <span class='raise identifier id'>raise</span> <span class='ConfigurationError constant id'>ConfigurationError</span><span class='comma token'>,</span> <span class='string val'>&quot;No DAITSS_CONFIG environment variable has been set, so there's no configuration file to read&quot;</span>             <span class='unless unless_mod kw'>unless</span> <span class='ENV constant id'>ENV</span><span class='lbrack token'>[</span><span class='string val'>'DAITSS_CONFIG'</span><span class='rbrack token'>]</span>
  <span class='raise identifier id'>raise</span> <span class='ConfigurationError constant id'>ConfigurationError</span><span class='comma token'>,</span> <span class='string val'>&quot;The VIRTUAL_HOSTNAME environment variable has not been set&quot;</span>                                               <span class='unless unless_mod kw'>unless</span> <span class='ENV constant id'>ENV</span><span class='lbrack token'>[</span><span class='string val'>'VIRTUAL_HOSTNAME'</span><span class='rbrack token'>]</span>
  <span class='raise identifier id'>raise</span> <span class='ConfigurationError constant id'>ConfigurationError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;The DAITSS_CONFIG environment variable points to a non-existant file, (#{ENV['DAITSS_CONFIG']})&quot;</span>          <span class='unless unless_mod kw'>unless</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='exists? fid id'>exists?</span> <span class='ENV constant id'>ENV</span><span class='lbrack token'>[</span><span class='string val'>'DAITSS_CONFIG'</span><span class='rbrack token'>]</span>
  <span class='raise identifier id'>raise</span> <span class='ConfigurationError constant id'>ConfigurationError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;The DAITSS_CONFIG environment variable points to a directory instead of a file (#{ENV['DAITSS_CONFIG']})&quot;</span>     <span class='if if_mod kw'>if</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='directory? fid id'>directory?</span> <span class='ENV constant id'>ENV</span><span class='lbrack token'>[</span><span class='string val'>'DAITSS_CONFIG'</span><span class='rbrack token'>]</span>
  <span class='raise identifier id'>raise</span> <span class='ConfigurationError constant id'>ConfigurationError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;The DAITSS_CONFIG environment variable points to an unreadable file (#{ENV['DAITSS_CONFIG']})&quot;</span>            <span class='unless unless_mod kw'>unless</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='readable? fid id'>readable?</span> <span class='ENV constant id'>ENV</span><span class='lbrack token'>[</span><span class='string val'>'DAITSS_CONFIG'</span><span class='rbrack token'>]</span>

  <span class='config identifier id'>config</span> <span class='assign token'>=</span> <span class='Datyl constant id'>Datyl</span><span class='colon2 op'>::</span><span class='Config constant id'>Config</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='ENV constant id'>ENV</span><span class='lbrack token'>[</span><span class='string val'>'DAITSS_CONFIG'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='symbol val'>:defaults</span><span class='comma token'>,</span> <span class='symbol val'>:database</span><span class='comma token'>,</span> <span class='ENV constant id'>ENV</span><span class='lbrack token'>[</span><span class='string val'>'VIRTUAL_HOSTNAME'</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>

  
  <span class='lbrack token'>[</span> <span class='string val'>'storage_master_db'</span><span class='comma token'>,</span> <span class='string val'>'required_pools'</span> <span class='rbrack token'>]</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='option identifier id'>option</span><span class='bitor op'>|</span>
    <span class='raise identifier id'>raise</span> <span class='ConfigurationError constant id'>ConfigurationError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;The option '#{option}' was not found in the configuration file #{ENV['DAITSS_CONFIG']}&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='config identifier id'>config</span><span class='lbrack token'>[</span><span class='option identifier id'>option</span><span class='rbrack token'>]</span>
  <span class='end end kw'>end</span>

  <span class='return return kw'>return</span> <span class='config identifier id'>config</span>
<span class='end end kw'>end</span>
</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Mon Nov 21 11:54:25 2011 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.7.3 (ruby-1.8.7).
</div>

  </body>
</html>